<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
<title>Right Hand Phone Hold – Refined</title>
<style>
html,body{
  margin:0;padding:0;width:100%;height:100%;
  background:#000;overflow:hidden;
}
svg{width:100vw;height:100vh;display:block;}
#ui{
  position:fixed;left:0;right:0;bottom:0;
  display:flex;gap:10px;justify-content:center;
  padding:12px;background:rgba(0,0,0,.55);
}
button{
  padding:10px 14px;border-radius:12px;
  border:1px solid rgba(255,255,255,.2);
  background:rgba(255,255,255,.1);
  color:#eee;
}
#badge{
  position:fixed;top:18px;left:50%;
  transform:translateX(-50%);
  color:#aaa;font-size:14px;letter-spacing:.1em;
}
.handFill{fill:rgba(255,255,0,.25);}
.fingerLine,.thumbLine{
  stroke:#ff0;stroke-width:6;
  stroke-linecap:round;fill:none;
}
.nail{fill:#ff0;}
.phone{
  fill:#1e6cff;rx:18;ry:18;
  opacity:0;
}
</style>
</head>

<body>
<div id="badge">RELAX</div>

<div id="ui">
  <button onclick="go('RELAX')">RELAX</button>
  <button onclick="go('HOLD')">HOLD</button>
  <button onclick="go('LOCK')">LOCK</button>
  <button onclick="go('MINI')">MINI</button>
</div>

<svg viewBox="0 0 400 720">

<!-- phone：縦長化（+30%）、位置固定、非回転 -->
<rect id="phone" class="phone" x="155" y="245" width="90" height="180"/>

<!-- palm + wrist（非回転・不可視境界） -->
<path class="handFill"
 d="M120 240 Q200 195 280 240 L280 365 Q200 405 120 365 Z"/>
<path class="handFill"
 d="M150 365 Q200 410 250 365 L250 455 Q200 485 150 455 Z"/>

<!-- fingers group（4指のみ回旋） -->
<g id="fingersGroup">
  <line id="index"  class="fingerLine"/>
  <line id="middle" class="fingerLine"/>
  <line id="ring"   class="fingerLine"/>
  <line id="little" class="fingerLine"/>
</g>

<!-- thumb（独立） -->
<g id="thumbGroup">
  <line id="thumbA" class="thumbLine"/>
  <line id="thumbB" class="thumbLine"/>
</g>

<!-- nails -->
<g id="nails">
  <polygon id="n_index" class="nail"/>
  <polygon id="n_middle" class="nail"/>
  <polygon id="n_ring" class="nail"/>
  <polygon id="n_little" class="nail"/>
  <polygon id="n_thumb" class="nail"/>
</g>

</svg>

<script>
/* ===== 基本設定 ===== */
const baseY = 245;
const pivot = {x:200,y:330};

const F = {
 index:  {x:215,relax:100,hold:62,lock:50,mini:58},
 middle: {x:195,relax:92, hold:60,lock:52,mini:56},
 ring:   {x:175,relax:82, hold:56,lock:48,mini:52},
 little: {x:155,relax:72, hold:52,lock:46,mini:50}
};

const Thumb = {
 base:{x:270,y:310},
 RELAX:{mid:{x:255,y:280},tip:{x:240,y:255}},
 HOLD: {mid:{x:248,y:320},tip:{x:230,y:330}},
 LOCK: {mid:{x:252,y:340},tip:{x:238,y:360}},
 MINI: {mid:{x:258,y:330},tip:{x:250,y:345}} // 逆方向に逃がす
};

const rot = {
 RELAX:0,
 HOLD:-90,
 LOCK:-90,
 MINI:-90
};

let current="RELAX";

/* ===== 描画関数 ===== */
function drawFinger(id,len){
 const f=F[id];
 const x1=f.x,y1=baseY;
 const x2=x1,y2=y1-len;
 const el=document.getElementById(id);
 el.setAttribute("x1",x1);
 el.setAttribute("y1",y1);
 el.setAttribute("x2",x2);
 el.setAttribute("y2",y2);
 return {x:x2,y:y2};
}

function nail(id,x,y,dir){
 const s=7;
 const dx=Math.sin(dir)*10;
 const dy=-Math.cos(dir)*10;
 document.getElementById(id).setAttribute(
  "points",
  `${x},${y} ${x-dx-s},${y-dy-s} ${x-dx+s},${y-dy-s}`
 );
}

function clearNails(){
 document.querySelectorAll(".nail").forEach(n=>n.setAttribute("points",""));
}

function drawThumb(state){
 const p=Thumb[state];
 document.getElementById("thumbA")
  .setAttribute("x1",Thumb.base.x);
 document.getElementById("thumbA")
  .setAttribute("y1",Thumb.base.y);
 document.getElementById("thumbA")
  .setAttribute("x2",p.mid.x);
 document.getElementById("thumbA")
  .setAttribute("y2",p.mid.y);
 document.getElementById("thumbB")
  .setAttribute("x1",p.mid.x);
 document.getElementById("thumbB")
  .setAttribute("y1",p.mid.y);
 document.getElementById("thumbB")
  .setAttribute("x2",p.tip.x);
 document.getElementById("thumbB")
  .setAttribute("y2",p.tip.y);
 if(state==="RELAX"){
  nail("n_thumb",p.tip.x,p.tip.y,0);
 }
}

/* ===== 状態遷移 ===== */
function apply(state){
 current=state;
 document.getElementById("badge").textContent=state;
 document.getElementById("phone").style.opacity=
  (state==="RELAX")?0:1;

 const g=document.getElementById("fingersGroup");
 g.setAttribute(
  "transform",
  `rotate(${rot[state]} ${pivot.x} ${pivot.y})`
 );

 clearNails();

 if(state==="RELAX"){
  for(const k in F){
   const p=drawFinger(k,F[k].relax);
   nail("n_"+k,p.x,p.y,0);
  }
  drawThumb("RELAX");
 }else{
  for(const k in F){
   drawFinger(k,F[k][state.toLowerCase()]);
  }
  drawThumb(state);
 }
}

function go(state){ apply(state); }

apply("RELAX");
</script>
</body>
</html>
